#!/usr/bin/env php
<?php

use Task\ProjectFinder;
use Symfony\Component\Console\Application;
use Symfony\Component\Console\Output\ConsoleOutput;

$loader = null;
foreach ([
    __DIR__.'/../../../autoload.php', # COMPOSER_HOME/vendor/task/task/bin
    __DIR__.'/../vendor/autoload.php' # ./bin
] as $autoload) {
    if (file_exists($autoload)) {
        $loader = require $autoload;
        break;
    }
}

if (empty($loader)) {
    throw new \Exception('No autoloader found');
}

try {
    $project = (new Task\ProjectFinder)->find();
} catch (Exception $ex) {
    (new Application)->renderException($ex, new ConsoleOutput);
    exit(1);
}

$project->run();

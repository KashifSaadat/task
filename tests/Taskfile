<?php

use Task\Plugin;
use Symfony\Component\Console\Input\InputDefinition;
use Symfony\Component\Console\Input\InputOption;

$tasks = new Task\Project('test');

$tasks->plugins(function($plugins) {
    $plugins['ps'] = Plugin\ProcessPlugin::factory($plugins);
});

$tasks->add('welcome', function($input, $output) {
    $output->writeln('Welcome to Tasks!');
});

$tasks->add('greet', function($input, $output) {
    if ($name = $input->getOption('name')) {
        $greeting = "Hello, $name!";
    } else {
        $greeting = "Hello!";
    }

    $output->writeln($greeting);
}, [], new InputDefinition([
    new InputOption('name', null, InputOption::VALUE_REQUIRED)
]));

$tasks->add('whoami', function($input, $output) use ($tasks) {
    $whoami = $tasks->plugins['ps']->run('whoami')->getOutput();
    $output->write($whoami);
}, ['welcome']);

$tasks->add('hello', ['welcome', 'greet']);

return $tasks;
